import Zoom from 'react-medium-image-zoom'
import Mermaid from '../../components/Mermaid'

# Understand and estimate XMTP fees

Use this guide to understand XMTP fees and how to estimate XMTP fees for an app or agent.

## Understand XMTP fees

To support a decentralized and sustainable network, XMTP operates on a usage-based fee model. The fees paid by apps and agents (payers) directly compensate the independent node operators who run the infrastructure, ensuring the network remains resilient, secure, and censorship-resistant.

### Fee types

To understand XMTP fee types, it's helpful to understand XMTP's architecture, which uses a two-layer system:

1.  **XMTP Broadcast Network** (offchain): A globally distributed network of nodes responsible for securely routing and delivering encrypted messages between users.
2.  **XMTP Appchain** (onchain): A specialized blockchain that stores critical metadata, such as user identities, contacts, and group permissions. This onchain layer is essential for decentralized identity and ensuring that only the appropriate users can access conversations.

### Messaging fees

Messages sent through the **XMTP Broadcast Network** incur these types of **messaging fees**:

- **Base fee**: A flat per-message fee.
- **Storage fee**: A fee charged per-byte-day of storage required. A 100-byte message stored for 30 days would be calculated as 3,000-byte-days.
- **Congestion fee**: A dynamic fee computed by looking at the recent activity of an originator. Added only during periods of high network activity.

The dollar value of the flat per-message base fee, per-byte-day storage fee, and congestion fee are stored in a smart contract and remain constant for a specified period of time. These fees are set and adjusted through protocol governance.

Every message an app or agent sends through the XMTP Broadcast Network counts toward its message volume. These message types include:

- App messages (text, reactions, replies)
- Media attachments (charged by size, capped at 1 MB)
- System messages (read receipts, typing indicators)

To learn more, see [Envelope types](/protocol/envelope-types).

Collected messaging fees are paid directly to the node operators who run the globally distributed nodes that power the XMTP Broadcast Network.

#### Messaging fee payment flow

This sequence diagram illustrates the messaging fee payment flow from payers to independent node operators using a series of smart contracts.

<Zoom>
<Mermaid
  id="payer-to-node"
  chart={`
    sequenceDiagram
        actor Payer
        participant PayerRegistry
        participant PayerReportManager
        participant DistributionManager
        participant NodeRegistry
        actor NodeOperator as Node operator

        Payer->>PayerRegistry: 1. Allocates USDC to cover usage fees
        Note over PayerReportManager: Node operator submits payer usage reports
        PayerReportManager->>PayerRegistry: 2. Deducts fees from payer's balance
        PayerRegistry->>DistributionManager: 3. Transfers collected fees
        NodeOperator->>DistributionManager: 4. Claims share of fees
        DistributionManager->>NodeRegistry: 5. Verifies claimant is node owner
        NodeRegistry-->>DistributionManager: Returns node owner's address
        DistributionManager->>NodeOperator: 6. Transfers earned fees to node operator
`}
/>
</Zoom>

### Gas fees

Commit messages sent through the **XMTP Appchain** incur **gas fees**. Commit messages require transactions on the XMTP Appchain. Gas fees are paid directly from the payer wallet's XMTP Appchain allowance.

Every commit message an app or agent sends through the XMTP Appchain counts toward its message volume. Commit messages are typically used to perform:

- Group management updated (member additions, permission changes)
- Identity updates
- Consent preferences updates
- Payer-related updates

To learn more, see [Envelope types](/protocol/envelope-types).

Collected gas fees are paid directly to the XMTP Appchain. Fees are used to maintain the Appchain.

## Estimate XMTP fees

Use the [XMTP fee calculator](#TODO) to help you estimate fees to be incurred by your app or agent. This calculator uses network averages, which provides estimates at the correct order of magnitude.

Here are rough estimates of XMTP Broadcast Network and XMTP Appchain fees:

- **Messaging fee**: At launch, a 1 KB text message sent to the XMTP Broadcast Network incurs a fee of ~0.001 USDC (≈ $1 per 1,000 small messages).

- **Gas fee**: A message that triggers a commit to the XMTP Appchain incurs a ≤ 500 gwei fee, which works out to fractions of a cent.

### Pricing and network scale

The network is designed to be profitable at 1B messages/month. As volume grows beyond this point, surplus revenue is recycled to lower the global per-byte price for everyone.

## FAQ about XMTP fees

### What determines the effective price per message?

Messaging fees are charged per byte, with total fees scaling linearly with bytes sent. The effective per-message rate shown in the estimator assumes a 1,024-byte message and includes all components: base fees for message storage, gas fees for metadata written to XMTP’s L3, and a 5% protocol treasury share.

### Is price global or per-sender?

The protocol charges a single global per-byte rate that falls as total network volume rises. All developers benefit from lower per-byte rates as the network grows.

### Are attachments or large media extra?

No. They’re just larger messages. XMTP charges per byte, so sending media costs more only due to size—capped at 1 MB per message. For lower fees and larger files, use remote attachment messages to point to off-network storage like IPFS or S3.

### Is the current fee level sustainable for node operators?

Yes. The network is designed to be profitable at 1B messages/month. As volume grows beyond this point, surplus revenue is recycled to lower the global per-byte price for everyone.

### How are fees estimated for 100M or even 1B users?

At very high volumes, price converges to a global floor that ensures node operators remain sustainable. The current effective floor price is $3 per 100,000 messages. Future node efficiency improvements are expected to push this floor even lower.

### Do fees ever increase?

The system is designed for fees to decrease over time as volume grows and nodes become more efficient. However, if network volume drops significantly, the global per-byte price can rise to maintain sustainability. Congestion surcharges may occur briefly on overloaded nodes, but traffic can route through another node at the standard price.

### Where can I see a detailed fee breakdown?

All pricing is onchain and fully auditable. The XMTP Funding Portal shows per-byte fees, gas fees, and your historical and projected spend.

### How accurate is the $5 per 100K messages estimate?

This estimate assumes typical usage patterns (1 KB messages, 1-2 group operations per 100 messages). Most apps fall within 10% of this estimate.
