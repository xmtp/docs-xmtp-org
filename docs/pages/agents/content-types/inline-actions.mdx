# Support inline actions with your agent built with XMTP

Interactive button-based UI for XMTP agents following the XIP-67 specification. Users can tap buttons instead of typing commands, making interactions more intuitive and accessible.

## Install the package

:::code-group

```bash [npm]
npm i @xmtp/content-type-inline-actions
```

```bash [yarn]
yarn add @xmtp/content-type-inline-actions
```

```bash [pnpm]
pnpm add @xmtp/content-type-inline-actions
```

:::

## Configure the content type

After importing the package, you can register the codec:

```js [Node]
import { InlineActionsCodec } from "@xmtp/content-type-inline-actions";

// Create the XMTP agent
const agent = await Agent.create(signer, {
  env: "dev",
  codecs: [new InlineActionsCodec()],
});
```

## Quick Start

```typescript
import {
  ActionBuilder,
  inlineActionsMiddleware,
  registerAction,
} from "@xmtp/content-type-inline-actions";

// 1. Add middleware to your agent
agent.use(inlineActionsMiddleware);

// 2. Register action handlers
registerAction("my-action", async (ctx) => {
  await ctx.sendText("Action executed!");
});

// 3. Send interactive buttons
await ActionBuilder.create("my-menu", "Choose an option:")
  .add("my-action", "Click Me")
  .add("other-action", "Cancel")
  .send(ctx);
```

## Core Functions

### ActionBuilder

Create interactive button menus:

```typescript
await ActionBuilder.create("menu-id", "Description")
  .add("action-id", "Button Label") // primary|secondary|danger
  .add("action-id-2", "Another Button")
  .send(ctx);
```

### Helper Functions

**Confirmation dialogs:**

```typescript
await sendConfirmation(
  ctx,
  "Delete this item?",
  async (ctx) => await ctx.sendText("Deleted!"),
  async (ctx) => await ctx.sendText("Cancelled"),
);
```

**Selection menus:**

```typescript
await sendSelection(ctx, "Pick a color:", [
  {
    id: "red",
    label: "ðŸ”´ Red",
    handler: async (ctx) => {
      /* handle red */
    },
  },
  {
    id: "blue",
    label: "ðŸ”µ Blue",
    handler: async (ctx) => {
      /* handle blue */
    },
  },
]);
```

## Complete Example

Here's a complete example of an agent that uses inline actions:

```ts [Node]
import { Agent, createSigner, createUser } from "@xmtp/agent-sdk";
import {
  ActionBuilder,
  inlineActionsMiddleware,
  registerAction,
  sendConfirmation,
  sendSelection,
} from "@xmtp/content-type-inline-actions";

const agent = await Agent.create(signer, {
  env: "dev",
  codecs: [new InlineActionsCodec()],
});

// Add middleware to handle inline actions
agent.use(inlineActionsMiddleware);

// Register action handlers
registerAction("show-menu", async (ctx) => {
  await ActionBuilder.create("main-menu", "What would you like to do?")
    .add("get-info", "Get Info", "primary")
    .add("change-settings", "Change Settings", "secondary")
    .add("help", "Help", "secondary")
    .send(ctx);
});

registerAction("get-info", async (ctx) => {
  await ctx.sendText("Here's some information about the agent...");
  
  // Show options after providing info
  await ActionBuilder.create("info-menu", "What's next?")
    .add("show-menu", "Main Menu")
    .add("help", "More Help")
    .send(ctx);
});

registerAction("change-settings", async (ctx) => {
  await sendSelection(ctx, "Choose a setting to change:", [
    {
      id: "theme",
      label: "ðŸŽ¨ Theme",
      handler: async (ctx) => {
        await ctx.sendText("Theme settings would go here...");
      },
    },
    {
      id: "notifications",
      label: "ðŸ”” Notifications",
      handler: async (ctx) => {
        await ctx.sendText("Notification settings would go here...");
      },
    },
  ]);
});

registerAction("help", async (ctx) => {
  await ctx.conversation.send(`
# Help

This agent supports interactive buttons for easy navigation:

- **Get Info**: View agent information
- **Change Settings**: Modify agent settings
- **Help**: Show this help message

You can also type commands or use the interactive buttons above!
  `);
});

registerAction("delete-item", async (ctx) => {
  await sendConfirmation(
    ctx,
    "Are you sure you want to delete this item?",
    async (ctx) => {
      await ctx.sendText("Item deleted successfully!");
      await ActionBuilder.create("after-delete", "Item deleted. What's next?")
        .add("show-menu", "Main Menu")
        .add("help", "Help")
        .send(ctx);
    },
    async (ctx) => {
      await ctx.sendText("Delete cancelled.");
      await ActionBuilder.create("delete-cancelled", "Delete cancelled. What would you like to do?")
        .add("show-menu", "Main Menu")
        .add("help", "Help")
        .send(ctx);
    },
  );
});

// Handle text messages and show initial menu
agent.on("text", async (ctx) => {
  const message = ctx.message.content.toLowerCase();
  
  if (message.includes("menu") || message.includes("start")) {
    await ActionBuilder.create("welcome-menu", "Welcome! Choose an option:")
      .add("show-menu", "Main Menu", "primary")
      .add("help", "Help", "secondary")
      .send(ctx);
  } else if (message.includes("delete")) {
    await ActionBuilder.create("delete-menu", "Delete options:")
      .add("delete-item", "Delete Item", "danger")
      .add("show-menu", "Cancel", "secondary")
      .send(ctx);
  } else {
    // Default response with menu
    await ctx.sendText("I received your message! Here are some options:");
    await ActionBuilder.create("response-menu", "Choose an action:")
      .add("show-menu", "Main Menu")
      .add("help", "Help")
      .send(ctx);
  }
});

await agent.start();
```

## App Configuration

For complex bots with multiple menus, you can use app configuration:

```typescript
const config: AppConfig = {
  name: "My Bot",
  menus: {
    "main-menu": {
      id: "main-menu",
      title: "Main Menu",
      actions: [
        { id: "sub-menu", label: "Go to Sub Menu" },
        { id: "action-1", label: "Do Something", handler: myHandler },
      ],
    },
    "sub-menu": {
      id: "sub-menu",
      title: "Sub Menu",
      actions: [
        { id: "action-2", label: "Another Action", handler: anotherHandler },
        { id: "back", label: "Back to Main", handler: backToMainHandler },
      ],
    },
  },
};

initializeAppFromConfig(config);
```

## Action Handlers

Register handlers for button clicks:

```typescript
registerAction("my-action", async (ctx: MessageContext) => {
  // Handle the action
  await ctx.sendText("Action completed!");

  // Optionally show navigation options
  await showNavigationOptions(ctx, config, "What would you like to do next?");
});
```

## Validation Helpers

Built-in validators for common formats:

```typescript
import { validators } from "@xmtp/content-type-inline-actions";

const result = validators.inboxId("123abc...");
if (!result.valid) {
  await ctx.conversation.send(`Error: ${result.error}`);
}
```

## Button Types

You can specify different button types for visual distinction:

```typescript
await ActionBuilder.create("button-types", "Choose button type:")
  .add("primary-action", "Primary Button", "primary")
  .add("secondary-action", "Secondary Button", "secondary")
  .add("danger-action", "Danger Button", "danger")
  .send(ctx);
```

- `primary`: Main action (usually blue)
- `secondary`: Secondary action (usually gray)
- `danger`: Destructive action (usually red)


## Client Compatibility

Inline actions work with XMTP clients that support the XIP-67 specification. For maximum compatibility:

- Provide text alternatives for button actions
- Test with different clients to ensure proper rendering
- Use simple button layouts that work across devices
- Consider fallback text for unsupported clients
