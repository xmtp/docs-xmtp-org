# Streaming Group Changes with XMTP


Stream group metadata changes (name, description, members) in real-time using the `group_updated` native content type via XMTP's `streamAllMessages()`.


## Stream group updates

```typescript
on("message", async (ctx) => {
  // Check if message is a group update
  if (ctx.message.contentType?.typeId === "group_updated") {
    console.log("Group updated:", ctx.message.content);
  }
});
```

## Group update message structure

```typescript
{
  conversationId: string,
  contentType: { typeId: "group_updated" },
  content: {
    metadataFieldChanges?: Array<{
      fieldName: string,        // "group_name", "group_description", etc.
      oldValue: string,
      newValue: string
    }>,
    addedInboxes?: Array<{     // New members added
      inboxId: string
    }>,
    initiatedByInboxId?: string // Who triggered the update
  }
}
```

## Usage examples

### Monitor group name changes

```tsx
on("message", async (ctx) => {
  if (ctx.message.contentType?.typeId === "group_updated") {
    const content = ctx.message.content as any;

    const nameChange = content.metadataFieldChanges?.find(
      (change) => change.fieldName === "group_name",
    );

    if (nameChange) {
      console.log(
        `Group renamed: ${nameChange.oldValue} â†’ ${nameChange.newValue}`,
      );
    }
  }
});
```

### Track member additions

```typescript
on("message", async (ctx) => {
  if (ctx.message.contentType?.typeId === "group_updated") {
    const content = ctx.message.content as any;

    if (content.addedInboxes?.length > 0) {
      console.log(`New members added:`, content.addedInboxes);
    }
  }
});
```

### Track member removals

```typescript
on("message", async (ctx) => {
  if (ctx.message.contentType?.typeId === "group_updated") {
    const content = ctx.message.content as any;

    if (content.removedInboxes?.length > 0) {
      console.log(`Members removed:`, content.removedInboxes);
    }
  }
});
```

### Filter by specific group

```typescript
const targetGroupId = "your-group-conversation-id";

on("message", async (ctx) => {
  if (
    ctx.message.contentType?.typeId === "group_updated" &&
    ctx.message.conversationId === targetGroupId
  ) {
    console.log("Target group updated:", ctx.message.content);
  }
}); 
```

