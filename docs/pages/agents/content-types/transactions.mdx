# Support onchain transactions with your agent built with XMTP

This package provides an XMTP content type to support sending transactions to a wallet for execution.

::::tip[Quickstart]
To learn more, see the [Transactions example](https://github.com/xmtplabs/xmtp-agent-examples/tree/main/examples/xmtp-transactions) in the xmtp-agent-examples repo.
::::

The wallet send calls content type is built into the Agent SDK. No installation is required.

## How token transactions work

Before diving into the code, it helps to understand how token transactions work under the hood.

Tokens on EVM-compatible chains follow the [ERC-20 standard](https://eips.ethereum.org/EIPS/eip-20). Every token lives as its own smart contract on a specific chain. To work with a token, you'll need three pieces of information:

1. **The chain** your token lives on (e.g., Base)
2. **The token's contract address** on that chain (you can look these up on token trackers like [Basescan Tokens](https://basescan.org/tokens))
3. **The token's decimal places** which tell you how to convert between raw values and human-readable amounts

Take USDC on Base as an example: its contract address is [0x833589fcd6edb6e08f4c7c32d4f71b54bda02913](https://basescan.org/token/0x833589fcd6edb6e08f4c7c32d4f71b54bda02913) and it uses 6 decimals. So when you see a raw value of `1000000`, that's actually 1 USDC.

The [ERC-20 ABI](https://eips.ethereum.org/EIPS/eip-20#methods) gives you a few essential methods to interact with any token:

- **balanceOf**: Check how many tokens a given address holds.
- **decimals**: Query this on any ERC-20 contract to find out how many decimal places it uses.
- **transfer**: Move tokens from one address to another.

The good news is that the XMTP Agent SDK handles most of this for you, so you don't need to deal with raw contract calls yourself.

## Read the number of decimals

...

## Create a transaction request

With XMTP, a transaction request is represented using `wallet_sendCalls` with additional metadata for display.

```ts [Node]
const walletSendCalls: WalletSendCallsParams = {
  version: '1.0',
  from: '0x123...abc',
  chainId: '0x2105',
  calls: [
    {
      to: '0x456...def',
      value: '0x5AF3107A4000',
      metadata: {
        description: 'Send 0.0001 ETH on base to 0x456...def',
        transactionType: 'transfer',
        currency: 'ETH',
        amount: 100000000000000,
        decimals: 18,
        toAddress: '0x456...def',
      },
    },
    {
      to: '0x789...cba',
      data: '0xdead...beef',
      metadata: {
        description: 'Lend 10 USDC on base with Morpho @ 8.5% APY',
        transactionType: 'lend',
        currency: 'USDC',
        amount: 10000000,
        decimals: 6,
        platform: 'morpho',
        apy: '8.5',
      },
    },
  ],
};
```

## Send a transaction request

Once you have a transaction request, you can send it as part of your conversation:

```ts [Node]
import type { WalletSendCalls } from '@xmtp/agent-sdk';

await conversation.sendWalletSendCalls(walletSendCalls);
```

## Receive a transaction request

To receive and process a transaction request:

```ts [Node]
import type { WalletSendCalls } from '@xmtp/agent-sdk';

if (ctx.isWalletSendCalls()) {
  const walletSendCalls: WalletSendCalls = ctx.message.content;
  // Process the transaction request here
}
```

You are welcome to provide feedback on this implementation by commenting on [XIP-59: Trigger on-chain calls via wallet_sendCalls](https://community.xmtp.org/t/xip-59-trigger-on-chain-calls-via-wallet-sendcalls/889).
