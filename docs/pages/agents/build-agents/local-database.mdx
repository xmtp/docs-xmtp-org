# Manage agent local database files and installations

## Understand local database files

XMTP creates local database files in the `dbPath` (default is `'/'`) directory. These files store your device identity and message history.

**Database file naming:**

Database files follow this pattern: `xmtp-{environment}-{inbox-id}.db3`

Example:

```bash
xmtp-production-62ff7c82fa2e8c9a0a0c9e58e7247704d102c41e5ceb4dc3573792d7d7a1c688.db3
```

- `xmtp-production`: Environment prefix
- `62ff7c82fa2e8c9a0a0c9e58e7247704d102c41e5ceb4dc3573792d7d7a1c688`: Inbox ID (Your xmtp identity)
- `.db3`: SQLite database file extension

**Keep these files between deployments:**

- Deleting them creates a new installation each time
- Reusing them maintains the same installation
- Each inbox can have up to 10 installations

**For production deployments:**

- Use persistent volumes (Railway volumes, Render disks, etc.)
- The database needs to persist across restarts

:::warning[Note]

If you hit the 10 installation limit, use [this script](https://github.com/ephemeraHQ/xmtp-agent-examples?tab=readme-ov-file#revoke-installations) to revoke installations.

:::

## Understand installations

With XMTP, your agent has an inbox that you use to access its messages. An inbox can have multiple identities associated with it. Your agent's identity has a kind (such as EOA or SCW) and a string, which in the case of an EOA or SCW, is an Ethereum address. All messages associated with your agent's identity flow through the one inbox ID.

When you deploy your agent to a platform, you create an XMTP client for your agent. The client creates an inbox ID and installation ID associated with your agent's identity. Each time you deploy your agent to a new platform, it creates a new installation for the same inbox ID. The installation represents your agent running on that specific platform.

For example, consider deploying your agent to these platforms:

- Local development: Creates an installation
- Railway: Creates another installation
- Production server: Creates another installation

Your agent can have **up to 10 active installations** before you need to revoke one to add another. Installations only accumulate for agent deployments using the same XMTP network environment, such as `local`, `dev`, or `production`.

For example, if you deploy your agent across these network environments, you will have 3 inboxes, each with 1 installation:

- Local development: `local` network
- Railway: `dev` network
- Production server: `production` network

<div>
  <img
    src="https://raw.githubusercontent.com/xmtp/docs-xmtp-org/refs/heads/main/docs/pages/img/agent-install-sep.png"
    width="500px"
    alt="Diagram showing agent deployments across different network environments (local, dev, production) creating separate inboxes with one installation each"
  />
</div>

If you deploy your agent to this same network environment, you have 1 inbox with 3 installations:

- Local development: `production` network
- Railway: `production` network
- Production server: `production` network

<div>
  <img
    src="https://raw.githubusercontent.com/xmtp/docs-xmtp-org/refs/heads/main/docs/pages/img/agent-install.png"
    width="500px"
    alt="Diagram showing agent deployments to the same production network environment creating one inbox with three installations"
  />
</div>

Here are some best practices for agent installation management:

- Configure your deployments to preserve the agent's database
- Consider how many platforms you'll need before hitting the 10 installation limit
- Keep track of which installation corresponds to which platform
- Regularly [check how many installations your agent has](/agents/deploy/debug-agents)
- [Revoke installations](#revoke-agent-installations) from platforms you no longer use

## Common agent installation scenarios

### Deploy to a new platform

When you deploy your agent to a new platform (e.g., from Railway to Fly.io):

- Your agent creates a new installation for the new platform
- If you already have 10 installations, you'll need to [revoke one first](#revoke-agent-installations)
- The new installation will start fresh without conversation history

### Update an existing deployment

When you redeploy your agent to the same platform:

- If the platform preserves the database, the same installation continues working
- If the platform doesn't preserve the database, a new installation is created

## Revoke agent installations

:::warning[Important]

Revoking an installation is permanent. You cannot recover access to a revoked installation.

:::

When you revoke an agent installation, it can no longer send or receive messages. However, you can still access the local database.

Your agent can still run from any active installations on other deployment platforms.

To revoke an agent installation, use [revokeInstallations.ts](https://github.com/ephemeraHQ/xmtp-agent-examples/blob/eb1dc17e99570b77de906ba0d58094586a4af844/scripts/revokeInstallations.ts) in the xmtp-agent-examples repo. For example:

```bash
yarn revoke <inbox-id> <installations-to-exclude>
```
