# Sync conversations and messages

## ðŸŽ¥ walkthrough: Syncing

This video provides a walkthrough of key concepts required to implement syncing correctly.

<iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/jl7P0onApxw?si=YNafIHebx9Kxycos"
  title="YouTube video player"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  referrerPolicy="strict-origin-when-cross-origin"
  allowFullScreen
></iframe>

## Sync a specific conversation

Get all new messages and group updates (name, description, etc.) for a specific conversation from the network.

:::code-group

```js [Browser]
await client.conversation.sync();
```

```js [Node]
await client.conversation.sync();
```

```tsx [React Native]
await client.conversation.sync();
```

```kotlin [Kotlin]
client.conversation.sync()
```

```swift [Swift]
try await client.conversation.sync()
```

:::

## Manually request sync from other devices

When a device installation comes online, it automatically sends a request to other devices on the network to sync conversations and messages. However, in scenarios where this automatic process is interrupted, you can manually trigger a sync request.

:::code-group

```js [Browser]
await client.sendSyncRequest();
```

```js [Node]
await client.sendSyncRequest();
```

```tsx [React Native]
await client.sendSyncRequest();
```

```kotlin [Kotlin]
client.sendSyncRequest()
```

```swift [Swift]
try await client.sendSyncRequest()
```

:::

## Sync new conversations

Get any new group chat or DM conversations from the network.

:::code-group

```js [Browser]
await client.conversations.sync();
```

```js [Node]
await client.conversations.sync();
```

```tsx [React Native]
await client.conversations.sync();
```

```kotlin [Kotlin]
client.conversations.sync()
```

```swift [Swift]
try await client.conversations.sync()
```

:::

## Sync new welcomes, conversations with unread messages, and preferences

Use `syncAll` to sync the following from the network:

- New welcomes
- Group chat and DM conversations with a [consent state](/chat-apps/user-consent/user-consent#how-user-consent-preferences-are-set) of allowed or unknown that have unread messages
- [Preference updates](/chat-apps/list-stream-sync/sync-preferences)

We recommend syncing messages for allowed conversations only. This ensures that spammy conversations with a consent state of unknown don't take up networking resources. This also ensures that unwanted spam messages aren't stored in the user's local database.

To sync conversations regardless of consent state, pass `[ALLOWED, UNKNOWN, DENIED]`.

To sync preferences only, you can call [`preferences.sync`](/chat-apps/list-stream-sync/sync-preferences). Note that `preferences.sync` will also sync welcomes to ensure that you have all potential new installations before syncing.

The method returns a summary object that includes the total number of conversations eligible for syncing and the number of conversations that were actually synced.

:::code-group

```js [Browser]
// Returns the number of conversations synced
const numSynced = await client.conversations.syncAll(['allowed']);
```

```js [Node]
// Returns the number of conversations synced
const numSynced = await client.conversations.syncAll(['allowed']);
```

```tsx [React Native]
// Returns a GroupSyncSummary object with detailed sync statistics
const syncSummary = await client.conversations.syncAllConversations([
  'allowed',
]);

// Access the sync statistics
console.log(`Eligible conversations: ${syncSummary.numEligible}`);
console.log(`Successfully synced: ${syncSummary.numSynced}`);

// You can also use the summary to determine sync completion rate
const completionRate = (syncSummary.numSynced / syncSummary.numEligible) * 100;
console.log(`Sync completion rate: ${completionRate.toFixed(1)}%`);
```

```kotlin [Kotlin]
// Returns a GroupSyncSummary object with sync statistics
val syncSummary = client.conversations.syncAllConversations(consentState = listOf(ConsentState.ALLOWED))
println("Eligible conversations: ${syncSummary.numEligible}")
println("Successfully synced: ${syncSummary.numSynced}")
```

```swift [Swift]
// Returns a GroupSyncSummary object with sync statistics
let syncSummary = try await client.conversations.syncAllConversations(consentState: [.allowed])
print("Eligible conversations: \(syncSummary.numEligible)")
print("Successfully synced: \(syncSummary.numSynced)")
```

:::

## Manage database connections

In some scenarios, you may need to temporarily release the local database connection, such as when performing database maintenance or when the app goes into the background for an extended period.

### Drop the database connection

Temporarily release the connection to the local database:

:::code-group

```tsx [React Native]
// Drop the local database connection
await client.dropLocalDatabaseConnection();
```

```kotlin [Kotlin]
// Drop the local database connection
client.dropLocalDatabaseConnection()
```

```swift [Swift]
// Drop the local database connection
try client.dropLocalDatabaseConnection()
```

:::

### Reconnect to the database

Reconnect to the local database after dropping the connection:

:::code-group

```tsx [React Native]
// Reconnect to the local database
await client.reconnectLocalDatabase();
```

```kotlin [Kotlin]
// Reconnect to the local database
client.reconnectLocalDatabase()
```

```swift [Swift]
// Reconnect to the local database
try await client.reconnectLocalDatabase()
```

:::

:::warning
After calling `dropLocalDatabaseConnection()`, any operations that require database access will fail until you call `reconnectLocalDatabase()`.
:::
