# List and count messages

Query messages from a conversation using filters including time ranges, delivery status, and content types. You can either retrieve the full message list or just get a message count for efficiency.

## Method parameters

Both `messages()` and `countMessages()` accept the same filtering parameters. All parameters are optional and can be combined to create precise filters:

| Parameter | Type | Description |
|-----------|------|-------------|
| `limit` | `Int` / `Long` / `bigint` | Maximum number of messages to return (not available for `countMessages`) |
| `beforeNs` / `sentBeforeNs` | `Int64` / `Long` / `bigint` | Filter messages sent before this timestamp (nanoseconds) |
| `afterNs` / `sentAfterNs` | `Int64` / `Long` / `bigint` | Filter messages sent after this timestamp (nanoseconds) |
| `direction` | `SortDirection` / `string` | Sort order: `descending` (default, newest first) or `ascending` (oldest first). Not available for `countMessages` |
| `deliveryStatus` | `MessageDeliveryStatus` / `string` | Filter by delivery status: `all` (default), `published`, `unpublished`, or `failed` |
| `excludeContentTypes` / `excludedContentTypes` | Array | Content types to exclude (e.g., reactions, read receipts) |
| `excludeSenderInboxIds` | Array of strings | Inbox IDs whose messages should be excluded |

## List messages from a conversation

Retrieve messages from a conversation with optional filtering and pagination.

:::code-group

```swift [Swift]
// Get all messages
let messages = try await group.messages()

// Get the 10 most recent messages
let recentMessages = try await group.messages(limit: 10)

// Get messages after a specific time (e.g., for pagination or unread messages)
let lastCheckTimestamp: Int64 = 1738620126404999936
let newMessages = try await group.messages(afterNs: lastCheckTimestamp)

// Get messages from a DM conversation
let dm = try await client.conversations.findOrCreateDm(with: recipientInboxId)
let dmMessages = try await dm.messages(limit: 50)
```

```kotlin [Kotlin]
// Get all messages
val messages = group.messages()

// Get the 10 most recent messages
val recentMessages = group.messages(limit = 10)

// Get messages after a specific time (e.g., for pagination or unread messages)
val lastCheckTimestamp: Long = 1738620126404999936
val newMessages = group.messages(afterNs = lastCheckTimestamp)

// Get messages from a DM conversation
val dm = client.conversations.findOrCreateDm(recipientInboxId)
val dmMessages = dm.messages(limit = 50)
```

```tsx [React Native]
// Get all messages
const messages = await group.messages();

// Get the 10 most recent messages
const recentMessages = await group.messages({ limit: 10 });

// Get messages after a specific time (e.g., for pagination or unread messages)
const lastCheckTimestamp = 1738620126404999936;
const newMessages = await group.messages({
  afterNs: lastCheckTimestamp,
});

// Get messages from a DM conversation
const dm = await client.conversations.findOrCreateDm(recipientInboxId);
const dmMessages = await dm.messages({ limit: 50 });
```

```tsx [Browser]
// Get all messages
const messages = await group.messages();

// Get the 10 most recent messages
const recentMessages = await group.messages({ limit: 10n });

// Get messages after a specific time (e.g., for pagination or unread messages)
const lastCheckTimestamp = 1738620126404999936n;
const newMessages = await group.messages({
  sentAfterNs: lastCheckTimestamp,
});

// Get messages from a DM conversation
const dm = await client.conversations.findOrCreateDm(recipientInboxId);
const dmMessages = await dm.messages({ limit: 50n });
```

```tsx [Node]
// Get all messages
const messages = await group.messages();

// Get the 10 most recent messages
const recentMessages = await group.messages({ limit: 10n });

// Get messages after a specific time (e.g., for pagination or unread messages)
const lastCheckTimestamp = 1738620126404999936n;
const newMessages = await group.messages({
  sentAfterNs: lastCheckTimestamp,
});

// Get messages from a DM conversation
const dm = await client.conversations.findOrCreateDm(recipientInboxId);
const dmMessages = await dm.messages({ limit: 50n });
```

:::

## Count messages in a conversation

Get a count of messages without retrieving the full message list. This is more efficient when you only need the number, such as for unread message badges.

:::code-group

```swift [Swift]
// Get total message count
let totalCount = try group.countMessages()

// Get count of messages after last check (for unread badge)
let lastCheckTimestamp: Int64 = 1738620126404999936
let unreadCount = try group.countMessages(afterNs: lastCheckTimestamp)

// Get count for a DM conversation
let dm = try await client.conversations.findOrCreateDm(with: recipientInboxId)
let dmUnreadCount = try dm.countMessages(afterNs: lastCheckTimestamp)
```

```kotlin [Kotlin]
// Get total message count
val totalCount = group.countMessages()

// Get count of messages after last check (for unread badge)
val lastCheckTimestamp: Long = 1738620126404999936
val unreadCount = group.countMessages(afterNs = lastCheckTimestamp)

// Get count for a DM conversation
val dm = client.conversations.findOrCreateDm(recipientInboxId)
val dmUnreadCount = dm.countMessages(afterNs = lastCheckTimestamp)
```

```tsx [React Native]
// Not yet available in React Native
```

```tsx [Browser]
// Get total message count
const totalCount = await group.countMessages();

// Get count of messages after last check (for unread badge)
const lastCheckTimestamp = 1738620126404999936n;
const unreadCount = await group.countMessages({
  sentAfterNs: lastCheckTimestamp,
});

// Get count for a DM conversation
const dm = await client.conversations.findOrCreateDm(recipientInboxId);
const dmUnreadCount = await dm.countMessages({
  sentAfterNs: lastCheckTimestamp,
});
```

```tsx [Node]
// Get total message count
const totalCount = await group.countMessages();

// Get count of messages after last check (for unread badge)
const lastCheckTimestamp = 1738620126404999936n;
const unreadCount = await group.countMessages({
  sentAfterNs: lastCheckTimestamp,
});

// Get count for a DM conversation
const dm = await client.conversations.findOrCreateDm(recipientInboxId);
const dmUnreadCount = await dm.countMessages({
  sentAfterNs: lastCheckTimestamp,
});
```

:::

## Paginate messages

Here's how to implement pagination to load messages in chunks:

:::code-group

```swift [Swift]
// Initial load
var currentMessages = try await group.messages(limit: 20)

// Function to load more messages
// Note: Assumes you're tracking currentMessages in your app state
func loadMoreMessages(conversation: Conversation, pageSize: Int = 20) async throws -> [DecodedMessage] {
    // Get the oldest message currently loaded from your tracked messages
    let oldestMessage = currentMessages.last

    // Load the next page of messages before the oldest one
    let messages = try await conversation.messages(
        limit: pageSize,
        beforeNs: oldestMessage?.sentAtNs,
        direction: .descending
    )

    return messages
}

// Load next page
let nextPage = try await loadMoreMessages(conversation: group)
currentMessages.append(contentsOf: nextPage)
```

```kotlin [Kotlin]
// Initial load
var currentMessages = group.messages(limit = 20).toMutableList()

// Function to load more messages
// Note: Assumes you're tracking currentMessages in your app state
suspend fun loadMoreMessages(
    conversation: Conversation,
    pageSize: Int = 20
): List<DecodedMessage> {
    // Get the oldest message currently loaded from your tracked messages
    val oldestMessage = currentMessages.lastOrNull()

    // Load the next page of messages before the oldest one
    return conversation.messages(
        limit = pageSize,
        beforeNs = oldestMessage?.sentAtNs,
        direction = DecodedMessage.SortDirection.DESCENDING
    )
}

// Load next page
val nextPage = loadMoreMessages(group)
currentMessages.addAll(nextPage)
```

```tsx [React Native]
// Initial load
let currentMessages = await group.messages({ limit: 20 });

// Function to load more messages
// Note: Assumes you're tracking currentMessages in your app state
async function loadMoreMessages(
  conversation: Conversation,
  pageSize: number = 20
): Promise<DecodedMessage[]> {
  // Get the oldest message currently loaded from your tracked messages
  const oldestMessage = currentMessages[currentMessages.length - 1];

  // Load the next page of messages before the oldest one
  return await conversation.messages({
    limit: pageSize,
    beforeNs: oldestMessage?.sentAtNs,
    direction: 'DESCENDING',
  });
}

// Load next page
const nextPage = await loadMoreMessages(group);
currentMessages = [...currentMessages, ...nextPage];
```

```tsx [Browser]
async function loadMoreMessages(
  conversation: Conversation,
  pageSize: number = 20
): Promise<DecodedMessage[]> {
  // Get the oldest message currently loaded
  const oldestMessage = currentMessages[currentMessages.length - 1];

  // Load the next page of messages before the oldest one
  return await conversation.messages({
    limit: BigInt(pageSize),
    sentBeforeNs: oldestMessage?.sentAtNs,
    direction: 'descending',
  });
}

// Initial load
let currentMessages = await group.messages({ limit: 20n });

// Load next page
const nextPage = await loadMoreMessages(group);
currentMessages = [...currentMessages, ...nextPage];
```

```tsx [Node]
async function loadMoreMessages(
  conversation: Conversation,
  pageSize: number = 20
): Promise<DecodedMessage[]> {
  // Get the oldest message currently loaded
  const oldestMessage = currentMessages[currentMessages.length - 1];

  // Load the next page of messages before the oldest one
  return await conversation.messages({
    limit: BigInt(pageSize),
    sentBeforeNs: oldestMessage?.sentAtNs,
    direction: 'descending',
  });
}

// Initial load
let currentMessages = await group.messages({ limit: 20n });

// Load next page
const nextPage = await loadMoreMessages(group);
currentMessages = [...currentMessages, ...nextPage];
```

:::

## Filter messages and message counts

Apply the same filtering parameters to both retrieve filtered messages with `messages()` or get counts of filtered messages with `countMessages()`.

:::code-group

```swift [Swift]
// Using messages()
let messages = try await group.messages(
    afterNs: 1738620126404999936,
    deliveryStatus: .published,
    excludeContentTypes: [.reaction]
)

// Using countMessages()
let count = try group.countMessages(
    afterNs: 1738620126404999936,
    excludeSenderInboxIds: ["inbox_id_1"]
)
```

```kotlin [Kotlin]
// Using messages()
val reactionType = FfiContentType("xmtp.org", "reaction", 1, 0)
val messages = group.messages(
    afterNs = 1738620126404999936,
    deliveryStatus = DecodedMessage.MessageDeliveryStatus.PUBLISHED,
    excludedContentTypes = listOf(reactionType)
)

// Using countMessages()
val count = group.countMessages(
    afterNs = 1738620126404999936,
    excludeSenderInboxIds = listOf("inbox_id_1")
)
```

```tsx [React Native]
const messages = await group.messages({
  afterNs: 1738620126404999936,
  deliveryStatus: 'published',
  excludeContentTypes: ['reaction'],
  excludeSenderInboxIds: ['inbox_id_1'],
});
```

```tsx [Browser]
// Using messages()
const messages = await group.messages({
  sentAfterNs: 1738620126404999936n,
  deliveryStatus: 'published',
  excludeContentTypes: [ContentType.Reaction],
});

// Using countMessages()
const count = await group.countMessages({
  sentAfterNs: 1738620126404999936n,
  excludeSenderInboxIds: ['inbox_id_1'],
});
```

```tsx [Node]
// Using messages()
const messages = await group.messages({
  sentAfterNs: 1738620126404999936n,
  deliveryStatus: 'published',
  excludeContentTypes: [ContentType.Reaction],
});

// Using countMessages()
const count = await group.countMessages({
  sentAfterNs: 1738620126404999936n,
  excludeSenderInboxIds: ['inbox_id_1'],
});
```

:::
