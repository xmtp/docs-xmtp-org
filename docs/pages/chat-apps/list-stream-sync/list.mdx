# List conversations

## List existing conversations

Get a list of existing group chat and DM conversations in the local database.

By default, `list` returns only conversations with a [consent state](/chat-apps/user-consent/user-consent#how-user-consent-preferences-are-set) of allowed or unknown.

We recommend listing allowed conversations only. This ensures that spammy conversations with a consent state of unknown don't degrade the user experience.

To list all conversations regardless of consent state, use the `consentStates` option and pass all three consent states.

Conversations are listed in descending order by their `lastMessage` created at value. If a conversation has no messages, the conversation is ordered by its `createdAt` value.

:::code-group

```js [Browser]
const allConversations = await client.conversations.list({
  consentStates: [ConsentState.Allowed],
});
const allGroups = await client.conversations.listGroups({
  consentStates: [ConsentState.Allowed],
});
const allDms = await client.conversations.listDms({
  consentStates: [ConsentState.Allowed],
});
```

```js [Node]
const allConversations = await client.conversations.list({
  consentStates: [ConsentState.Allowed],
});
const allGroups = await client.conversations.listGroups({
  consentStates: [ConsentState.Allowed],
});
const allDms = await client.conversations.listDms({
  consentStates: [ConsentState.Allowed],
});
```

```tsx [React Native]
// List Conversation items
await alix.conversations.list(['allowed']);

// List only active conversations (simplified usage)
const alixConvoCount1 = await alix.conversations.list({
  isActive: true, // Only show active conversations
});

// List Conversation items and return only the fields set to true. Optimize data transfer
// by requesting only the fields the app needs.
await alix.conversations.list({
  members: false,
  consentState: false,
  description: false,
  creatorInboxId: false,
  addedByInboxId: false,
  isActive: false,
  lastMessage: true,
});

// Advanced filtering and pagination (v5.1.0+)
await alix.conversations.list(
  {}, // conversation options
  25, // limit
  ['allowed'], // consent states
  Date.now() - (7 * 24 * 60 * 60 * 1000) * 1000000, // createdAfterNs (last 7 days in nanoseconds)
  undefined, // createdBeforeNs
  Date.now() - (24 * 60 * 60 * 1000) * 1000000, // lastActivityAfterNs (last 24 hours in nanoseconds)
  undefined, // lastActivityBeforeNs
  'last_activity' // orderBy: 'created_at' | 'last_activity'
);

// List only groups with filters
await alix.conversations.listGroups(
  {}, // conversation options
  25, // limit
  ['allowed'], // consent states
  undefined, // createdAfterNs
  undefined, // createdBeforeNs
  undefined, // lastActivityAfterNs
  undefined, // lastActivityBeforeNs
  'created_at' // orderBy
);

// List only DMs with filters
await alix.conversations.listDms(
  {}, // conversation options
  25, // limit
  ['allowed'], // consent states
  undefined, // createdAfterNs
  undefined, // createdBeforeNs
  undefined, // lastActivityAfterNs
  undefined, // lastActivityBeforeNs
  'last_activity' // orderBy
);
```

```kotlin [Kotlin]
// List conversations (both groups and dms)
val conversations = alix.conversations.list()
val filteredConversations = client.conversations.list(consentState = ConsentState.ALLOWED)

// List just dms
val dms = alix.conversations.listDms()
val filteredDms = client.conversations.listDms(consentState = ConsentState.ALLOWED)

//List just groups
val groups = alix.conversations.listGroups()
val filteredGroups = client.conversations.listGroups(consentState = ConsentState.ALLOWED)

```

```swift [Swift]
// List conversations (both groups and dms)
let conversations = try await alix.conversations.list()
let orderFilteredConversations = try await client.conversations.list(consentState: .allowed)

// List just dms
let conversations = try await alix.conversations.listDms()
let orderFilteredConversations = try client.conversations.listDms(consentState: .allowed)

//List just groups
let conversations = try await alix.conversations.listGroups()
let orderFilteredConversations = try client.conversations.listGroups(consentState: .allowed)
```

:::

## List a user's active conversations

The `isActive()` method determines whether the current user is still an active member of a group conversation. For example:

- When a user is added to a group, `isActive()` returns `true` for that user
- When a user is removed from a group, `isActive()` returns `false` for that user

You can use a user's `isActive: true` value as a filter parameter when listing conversations. You can potentially have a separate section for "archived" or "inactive" conversations where you could use `isActive: false`.

## Paginate the conversation list

You can paginate the conversation list by using the `limit` parameter and either the `createdAtNs` or `lastActivityNs` parameters.

By default, the conversation will be sorted by last activity (either when the last message was sent, or the group's creation time if no messages are found) in descending order.

### Paginate by `createdAt`

For most pagination use cases, use the `createdBeforeNs` parameter for filtering and set `orderBy` to `createdAt`. This enables you to paginate against a stably sorted list. You can then perform a final sort of conversations in your app.

:::code-group

```ts [Browser]
const firstPage = await client.conversations.list({
  limit: 10,
  orderBy: 'createdAt'
});
const secondPage = await client.conversations.list({
  limit: 10,
  createdBeforeNs: firstPage[firstPage.length - 1].createdAtNs
});
```

```ts [Node]
const firstPage = await client.conversations.list({
  limit: 10,
  orderBy: 'createdAt'
});
const secondPage = await client.conversations.list({
  limit: 10,
  createdBeforeNs: firstPage[firstPage.length - 1].createdAtNs
});
```

```ts [React Native]
const firstPage = await client.conversations.list(
  {},
  10,        // limit
  undefined, // consentStates
  undefined, // createdAfterNs
  undefined, // createdBeforeNs
  undefined, // lastActivityAfterNs
  undefined, // lastActivityBeforeNs
  'created_at' // orderBy
);
const secondPage = await client.conversations.list(
  {},
  10,
  undefined,
  undefined,
  firstPage[firstPage.length - 1].createdAtNs, // createdBeforeNs
  undefined,
  undefined,
  'created_at'
);
```

```kotlin [Kotlin]
val firstPage = try client.conversations.list(limit = 10, orderBy = Conversations.ListConversationsOrderBy.CREATED_AT)
val secondPage = try client.conversations.list(
    limit = 10,
    createdBeforeNs = firstPage.last().createdAtNs
)
```

```swift [Swift]
let firstPage = try await client.conversations.list(limit: 10, orderBy: .createdAt)
let secondPage = try await client.conversations.list(createdBeforeNs: firstPage.last!.createdAtNs, limit: 10)
```

:::

### Edge case: Paginate by `lastActivityNs`

In the edge case where your app doesn't use streaming, you can choose to sort conversations by `lastActivityNs` for pagination because it won't stream unexpected new messages in the conversations.

Using `lastActivityNs` for pagination can work if the page size is very large and missing some conversations is tolerable.

:::warning[Do not use with streaming]

Do not sort by `lastActivityNs` for pagination in an app that uses streaming. This might cause conversations to "jump" between pages as new messages stream in, resulting in an unstable sort and an incomplete list of conversations.

:::

:::code-group

```ts [Browser]
const firstPage = await client.conversations.list({
  limit: 10
});
const secondPage = await client.conversations.list({
  limit: 10,
  lastActivityBeforeNs: firstPage[firstPage.length - 1].lastActivityNs
});
```

```ts [Node]
const firstPage = await client.conversations.list({
  limit: 10
});
const secondPage = await client.conversations.list({
  limit: 10,
  lastActivityBeforeNs: firstPage[firstPage.length - 1].lastActivityNs
});
```

```ts [React Native]
const firstPage = await client.conversations.list(
  {},
  10 // limit
);
const secondPage = await client.conversations.list(
  {},
  10,
  undefined,
  undefined,
  undefined,
  undefined,
  firstPage[firstPage.length - 1].lastActivityNs // lastActivityBeforeNs
);
```

```kotlin [Kotlin]
val firstPage = try client.conversations.list(limit = 10)
val secondPage = try client.conversations.list(
    limit = 10,
    lastActivityBeforeNs = firstPage.last().lastActivityNs
)
```

```swift [Swift]
let firstPage = try await client.conversations.list(limit: 10)
let secondPage = try await client.conversations.list(lastActivityBeforeNs: firstPage.last!.lastActivityAtNs, limit: 10)
```

:::
