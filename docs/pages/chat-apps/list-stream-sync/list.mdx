# List conversations

## List existing conversations

Get a list of existing group chat and DM conversations in the local database.

By default, `list` returns only conversations with a [consent state](/chat-apps/user-consent/user-consent#how-user-consent-preferences-are-set) of allowed or unknown.

We recommend listing allowed conversations only. This ensures that spammy conversations with a consent state of unknown don't degrade the user experience.

To list all conversations regardless of consent state, use the `consentStates` option and pass all three consent states.

Conversations are listed in descending order by their `lastMessage` created at value. If a conversation has no messages, the conversation is ordered by its `createdAt` value.

:::code-group

```js [Browser]
const allConversations = await client.conversations.list({
  consentStates: [ConsentState.Allowed],
});
const allGroups = await client.conversations.listGroups({
  consentStates: [ConsentState.Allowed],
});
const allDms = await client.conversations.listDms({
  consentStates: [ConsentState.Allowed],
});
```

```js [Node]
const allConversations = await client.conversations.list({
  consentStates: [ConsentState.Allowed],
});
const allGroups = await client.conversations.listGroups({
  consentStates: [ConsentState.Allowed],
});
const allDms = await client.conversations.listDms({
  consentStates: [ConsentState.Allowed],
});
```

```tsx [React Native]
// List Conversation items
await client.conversations.list(['allowed']);

// List only active conversations (simplified usage)
const activeConversations = await client.conversations.list({
  isActive: true, // Only show active conversations
});

// List conversations with advanced filtering
const filteredConversations = await client.conversations.list(
  { isActive: true }, // opts
  10, // limit
  ['allowed'], // consentStates
  Date.now() * 1000000 - 86400000000000, // createdAfterNs (24 hours ago)
  undefined, // createdBeforeNs
  Date.now() * 1000000 - 3600000000000, // lastActivityAfterNs (1 hour ago)
  undefined, // lastActivityBeforeNs
  'last_activity' // orderBy
);

// List conversations and return only specific fields to optimize data transfer
await client.conversations.list({
  members: false,
  consentState: false,
  description: false,
  creatorInboxId: false,
  addedByInboxId: false,
  isActive: false,
  lastMessage: true,
});
```

```kotlin [Kotlin]
// List conversations (both groups and dms)
val conversations = alix.conversations.list()
val filteredConversations = client.conversations.list(consentState = ConsentState.ALLOWED)

// List just dms
val dms = alix.conversations.listDms()
val filteredDms = client.conversations.listDms(consentState = ConsentState.ALLOWED)

//List just groups
val groups = alix.conversations.listGroups()
val filteredGroups = client.conversations.listGroups(consentState = ConsentState.ALLOWED)

```

```swift [Swift]
// List conversations (both groups and dms)
let conversations = try await alix.conversations.list()
let orderFilteredConversations = try await client.conversations.list(consentState: .allowed)

// List just dms
let conversations = try await alix.conversations.listDms()
let orderFilteredConversations = try client.conversations.listDms(consentState: .allowed)

//List just groups
let conversations = try await alix.conversations.listGroups()
let orderFilteredConversations = try client.conversations.listGroups(consentState: .allowed)
```

:::

## List a user's active conversations

The `isActive()` method determines whether the current user is still an active member of a group conversation. For example:

- When a user is added to a group, `isActive()` returns `true` for that user
- When a user is removed from a group, `isActive()` returns `false` for that user

You can use a user's `isActive: true` value as a filter parameter when listing conversations. You can potentially have a separate section for "archived" or "inactive" conversations where you could use `isActive: false`.

## Filter conversations with advanced options

The React Native SDK provides advanced filtering options for listing conversations. These parameters allow precise control over which conversations are returned:

| Parameter | Type | Description |
|-----------|------|-------------|
| `opts` | `ConversationOptions` | Configure which fields to include/exclude in the response |
| `limit` | `number` | Maximum number of conversations to return |
| `consentStates` | `ConsentState[]` | Filter by consent states (`['allowed']`, `['denied']`, etc.) |
| `createdAfterNs` | `number` | Filter conversations created after this timestamp (nanoseconds) |
| `createdBeforeNs` | `number` | Filter conversations created before this timestamp (nanoseconds) |
| `lastActivityAfterNs` | `number` | Filter conversations with activity after this timestamp (nanoseconds) |
| `lastActivityBeforeNs` | `number` | Filter conversations with activity before this timestamp (nanoseconds) |
| `orderBy` | `'created_at' \| 'last_activity'` | Order results by creation time or last activity (default: `'last_activity'`) |

:::code-group

```tsx [React Native]
// Filter conversations created in the last 7 days with recent activity
const recentConversations = await client.conversations.list(
  { isActive: true },
  50, // limit
  ['allowed'], // only allowed conversations
  Date.now() * 1000000 - 604800000000000, // createdAfterNs (7 days ago)
  undefined, // createdBeforeNs
  Date.now() * 1000000 - 86400000000000, // lastActivityAfterNs (24 hours ago)
  undefined, // lastActivityBeforeNs
  'last_activity' // orderBy
);

// Get conversations created in a specific time range
const conversationsInRange = await client.conversations.list(
  {},
  100,
  ['allowed'],
  startTimeNs, // createdAfterNs
  endTimeNs,   // createdBeforeNs
  undefined,
  undefined,
  'created_at'
);
```

:::

## Paginate the conversation list

You can paginate the conversation list by using the `limit` parameter and either the `createdAfterNs`/`createdBeforeNs` or `lastActivityAfterNs`/`lastActivityBeforeNs` parameters.

By default, conversations are sorted by last activity (either when the last message was sent, or the group's creation time if no messages are found) in descending order. You can change this behavior using the `orderBy` parameter.

### Paginate by `createdAt`

For most pagination use cases, use the `createdBeforeNs` parameter for filtering and set `orderBy` to `createdAt`. This enables you to paginate against a stably sorted list. You can then perform a final sort of conversations in your app.

:::code-group

```ts [Browser]
const firstPage = await client.conversations.list({
  limit: 10,
  orderBy: 'createdAt'
});
const secondPage = await client.conversations.list({
  limit: 10,
  createdBeforeNs: firstPage[firstPage.length - 1].createdAtNs
});
```

```ts [Node]
const firstPage = await client.conversations.list({
  limit: 10,
  orderBy: 'createdAt'
});
const secondPage = await client.conversations.list({
  limit: 10,
  createdBeforeNs: firstPage[firstPage.length - 1].createdAtNs
});
```

```ts [React Native]
// First page - get 10 most recently created conversations
const firstPage = await client.conversations.list(
  {},
  10,        // limit
  undefined, // consentStates
  undefined, // createdAfterNs
  undefined, // createdBeforeNs
  undefined, // lastActivityAfterNs
  undefined, // lastActivityBeforeNs
  'created_at' // orderBy
);

// Second page - get next 10 conversations created before the last one from first page
const secondPage = await client.conversations.list(
  {},
  10,        // limit
  undefined, // consentStates
  undefined, // createdAfterNs
  firstPage[firstPage.length - 1].createdAtNs, // createdBeforeNs
  undefined, // lastActivityAfterNs
  undefined, // lastActivityBeforeNs
  'created_at' // orderBy
);
```

```kotlin [Kotlin]
val firstPage = try client.conversations.list(limit = 10, orderBy = Conversations.ListConversationsOrderBy.CREATED_AT)
val secondPage = try client.conversations.list(
    limit = 10,
    createdBeforeNs = firstPage.last().createdAtNs
)
```

```swift [Swift]
let firstPage = try await client.conversations.list(limit: 10, orderBy: .createdAt)
let secondPage = try await client.conversations.list(createdBeforeNs: firstPage.last!.createdAtNs, limit: 10)
```

:::

### Edge case: Paginate by `lastActivityNs`

In the edge case where your app doesn't use streaming, you can choose to sort conversations by `lastActivityNs` for pagination because it won't stream unexpected new messages in the conversations.

Using `lastActivityNs` for pagination can work if the page size is very large and missing some conversations is tolerable.

:::warning[Do not use with streaming]

Do not sort by `lastActivityNs` for pagination in an app that uses streaming. This might cause conversations to "jump" between pages as new messages stream in, resulting in an unstable sort and an incomplete list of conversations.

:::

:::code-group

```ts [Browser]
const firstPage = await client.conversations.list({
  limit: 10
});
const secondPage = await client.conversations.list({
  limit: 10,
  lastActivityBeforeNs: firstPage[firstPage.length - 1].lastActivityNs
});
```

```ts [Node]
const firstPage = await client.conversations.list({
  limit: 10
});
const secondPage = await client.conversations.list({
  limit: 10,
  lastActivityBeforeNs: firstPage[firstPage.length - 1].lastActivityNs
});
```

```ts [React Native]
// First page - get 10 conversations with most recent activity
const firstPage = await client.conversations.list(
  {},
  10 // limit
);

// Second page - get next 10 conversations with activity before the last one from first page
const secondPage = await client.conversations.list(
  {},
  10,        // limit
  undefined, // consentStates
  undefined, // createdAfterNs
  undefined, // createdBeforeNs
  undefined, // lastActivityAfterNs
  firstPage[firstPage.length - 1].lastActivityNs, // lastActivityBeforeNs
  undefined  // orderBy (defaults to last_activity)
);
```

```kotlin [Kotlin]
val firstPage = try client.conversations.list(limit = 10)
val secondPage = try client.conversations.list(
    limit = 10,
    lastActivityBeforeNs = firstPage.last().lastActivityNs
)
```

```swift [Swift]
let firstPage = try await client.conversations.list(limit: 10)
let secondPage = try await client.conversations.list(lastActivityBeforeNs: firstPage.last!.lastActivityAtNs, limit: 10)
```

:::
