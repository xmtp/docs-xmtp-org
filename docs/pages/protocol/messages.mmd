sequenceDiagram
    %% ─── lifelines ─────────────────────────────────────
    actor Alix
    participant InboxC as Alix Inbox ID
    participant InstA  as Installation A
    participant InstB  as Installation B
    actor Bo
    participant InboxA as Bo Inbox ID

    %% ─── 1. bootstrap first installation ──────────────
    Alix->>InstA: **Key Package A** (wallet-signed)
    InstA->>InboxC: Register installation A

    %% ─── 2. start conversation with Bo ──────────────
    InstA->>Bo: **Welcome** → Bo
    Bo-->>InboxA: joins conversation

    %% ─── 3. first chat message ────────────────────────
    InstA->>Bo: **Chat** ("Hi Bo!")

    %% ─── 4. Alix adds a new device (Installation B) ───
    Alix->>InstB: **Key Package B** (wallet-signed)
    InstB->>InboxC: Register installation B

    %% ─── 5. identity-update commit to rotate keys ─────
    InstB->>Bo: **Commit** (identity-update → replace InstA keys)
    InstB->>Bo: **Chat** ("I'm on my new phone ✨")